name: Puc Minas
run-name: Terraform & Ansible
on: [push]
jobs:
  Deployment:
    runs-on: ubuntu-22.04
    steps:
      - name: Check out Repository
        uses: actions/checkout@v4
      - name: Install Terraform
        run: |
          wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
          echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
          sudo apt update && sudo apt install terraform
      - name: Install TFLint
        run: |
          curl -s https://raw.githubusercontent.com/terraform-linters/tflint/master/install_linux.sh | bash
      - name: Install Checkov
        run: |
          pip3 install checkov
      - name: Check Terraform, TFLint and Checkov installation
        run: |
          terraform --version
          tflint --version
          echo "checkov $(checkov --version)"
      - name: Terraform Lint
        run: |
          cd infra
          tflint --init
          terraform fmt
          tflint
          checkov --soft-fail --directory $(pwd)
          cd ..
      - name: Terraform Plan
        run: |
          echo Hello World!
      # - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      # - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      # - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      # - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      # - run: echo "🖥️ The workflow is now ready to test your code on the runner."
      # - name: List files in the repository
      #   run: |
      #     ls ${{ github.workspace }}
      # - run: echo "🍏 This job's status is ${{ job.status }}."
